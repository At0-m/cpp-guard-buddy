# Плагин «C/C++ Header Guard Buddy» для VS Code

## 1. Назначение

Плагин **C/C++ Header Guard Buddy** предназначен для автоматизации работы
с заголовочными файлами C/C++ в среде разработки **Visual Studio Code**.

Основные задачи:
- определять, есть ли в файле защита от двойного включения;
- автоматически добавлять **include guard** или директиву `#pragma once`;
- переключать тип защиты (include guard ↔ `#pragma once`) одной командой;
- отображать состояние защиты заголовка в строке состояния VS Code.

Типичные расширения, с которыми работает плагин:
`.h`, `.hpp`, `.hh`, `.hxx`.

---

## 2. Архитектура проекта

Проект реализован как стандартное расширение VS Code на TypeScript.

### 2.1. Основные файлы

- **`package.json`**  
  Описание расширения: имя, версия, категории, поддерживаемая версия VS Code.  
  Здесь же объявляются:
  - точка входа: `main: "./out/extension.js"`;
  - команды, доступные в Command Palette;
  - сочетания клавиш (`Ctrl + Alt + G` для переключения защиты);
  - события активации (`onLanguage:c`, `onLanguage:cpp`, `onCommand:…`).

- **`tsconfig.json`**  
  Конфигурация компилятора TypeScript: целевая версия JS, папки `src` и `out`,
  модульная система (`commonjs`), список типов (`node`, `vscode`).

- **`src/extension.ts`**  
  Основной модуль с логикой плагина:
  - регистрация команд и обработчиков;
  - анализ содержимого заголовочного файла;
  - вставка/удаление include guard’ов и `#pragma once`;
  - обновление строки состояния.

- **`README.md`**  
  Краткое описание плагина, возможности, инструкции по установке и использованию.

---

## 3. Логика работы плагина

### 3.1. Активация и жизненный цикл

При первом вызове команды или при открытии файла C/C++ VS Code
выполняет функцию:

- `activate(context: vscode.ExtensionContext)`

В этом методе:

1. Создаётся элемент **строки состояния** `statusItem`, который показывает
   текущий тип защиты (`pragma once`, `include guard` или `нет`).
2. Регистрируются три команды:
   - `cpp-guard-buddy.insertGuard` — вставить include guard;
   - `cpp-guard-buddy.usePragmaOnce` — использовать `#pragma once`;
   - `cpp-guard-buddy.toggle` — переключить текущий тип защиты.
3. Выполняется подписка на события:
   - открытие документа (`onDidOpenTextDocument`);
   - сохранение документа (`onDidSaveTextDocument`);
   - смена активного редактора (`onDidChangeActiveTextEditor`).
4. Вызывается `updateStatusBarForDoc` для активного документа,
   чтобы сразу отобразить корректный статус.

При выгрузке расширения вызывается функция:

- `deactivate()` — освобождает элемент статус-бара.

---

### 3.2. Определение типа файла и защиты

Для анализа файла используются вспомогательные функции:

- `isHeader(doc)`  
  Проверяет расширение файла и определяет, относится ли он к заголовкам C/C++.

- `hasPragmaOnce(doc)`  
  Просматривает первые строки документа (до 50) и ищет директиву
  `#pragma once`, пропуская пустые строки и комментарии.

- `extractGuardMacro(doc)`  
  Пытается найти классический include guard вида:

  ```c
  #ifndef MACRO_NAME
  #define MACRO_NAME
  ...
  #endif // MACRO_NAME